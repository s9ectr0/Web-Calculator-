<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #0f172a 0%, #1a1f35 100%);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            padding: 20px;
            color: #cbd5e1;
        }

        .container {
            display: flex;
            gap: 24px;
            max-width: 950px;
        }

        .calculator {
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7), inset 0 1px 0 rgba(255, 255, 255, 0.05);
            padding: 28px;
            width: 400px;
            border: 1px solid #334155;
        }

        .history {
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7), inset 0 1px 0 rgba(255, 255, 255, 0.05);
            padding: 28px;
            width: 300px;
            display: flex;
            flex-direction: column;
            border: 1px solid #334155;
        }

        .history h2 {
            color: #cbd5e1;
            font-size: 1.2em;
            margin-bottom: 16px;
            border-bottom: 2px solid #3b82f6;
            padding-bottom: 12px;
            font-weight: 600;
        }

        .history-items {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .history-items::-webkit-scrollbar {
            width: 6px;
        }

        .history-items::-webkit-scrollbar-track {
            background: #0f172a;
            border-radius: 10px;
        }

        .history-items::-webkit-scrollbar-thumb {
            background: #3b82f6;
            border-radius: 10px;
        }

        .history-item {
            background: rgba(59, 130, 246, 0.1);
            padding: 12px;
            border-radius: 8px;
            font-size: 0.9em;
            color: #cbd5e1;
            border-left: 3px solid #3b82f6;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .history-item:hover {
            background: rgba(59, 130, 246, 0.2);
            transform: translateX(4px);
        }

        .display {
            background: rgba(15, 23, 42, 0.8);
            color: #3b82f6;
            font-size: 2.4em;
            padding: 24px;
            border-radius: 14px;
            text-align: right;
            margin-bottom: 12px;
            word-wrap: break-word;
            word-break: break-all;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            border: 1.5px solid #3b82f6;
            font-weight: 400;
            letter-spacing: 0.3px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .expression {
            background: rgba(15, 23, 42, 0.6);
            color: #64748b;
            font-size: 1.1em;
            padding: 14px 20px;
            border-radius: 10px;
            text-align: right;
            margin-bottom: 16px;
            min-height: 32px;
            border: 1px solid #334155;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            word-break: break-all;
            font-weight: 500;
        }

        .memory {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            justify-content: space-around;
        }

        .memory-btn {
            flex: 1;
            padding: 10px 8px;
            font-size: 0.8em;
            border: 1.5px solid #3b82f6;
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.15s ease;
        }

        .memory-btn:hover {
            background: #3b82f6;
            color: #0f172a;
        }

        .memory-btn:active {
            transform: scale(0.96);
        }

        .memory-display {
            color: #3b82f6;
            font-size: 0.85em;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        button {
            padding: 18px;
            font-size: 1.1em;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.15s ease;
            font-weight: 600;
            letter-spacing: 0.3px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .number {
            background: rgba(148, 163, 184, 0.15);
            color: #cbd5e1;
            border: 1px solid #475569;
        }

        .number:hover {
            background: rgba(148, 163, 184, 0.25);
            border-color: #64748b;
        }

        .operator {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border: 1px solid #1d4ed8;
        }

        .operator:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
        }

        .equals {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            grid-column: span 2;
            border: 1px solid #047857;
        }

        .equals:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
        }

        .clear {
            background: rgba(244, 63, 94, 0.2);
            color: #f43f5e;
            grid-column: span 2;
            border: 1.5px solid #f43f5e;
            font-weight: 600;
        }

        .clear:hover {
            background: rgba(244, 63, 94, 0.3);
        }

        .delete {
            background: rgba(249, 115, 22, 0.2);
            color: #f97316;
            border: 1.5px solid #f97316;
            font-size: 0.95em;
        }

        .delete:hover {
            background: rgba(249, 115, 22, 0.3);
        }

        .advanced {
            background: rgba(168, 85, 247, 0.2);
            color: #d8b4fe;
            border: 1.5px solid #a855f7;
            font-size: 0.9em;
        }

        .advanced:hover {
            background: rgba(168, 85, 247, 0.3);
        }

        h1 {
            text-align: center;
            margin-bottom: 24px;
            color: #cbd5e1;
            font-size: 1.8em;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        @media (max-width: 900px) {
            .container {
                flex-direction: column;
                width: 100%;
            }

            .calculator,
            .history {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="calculator">
            <h1>Calculator</h1>
            <div class="memory-display" id="memoryDisplay"></div>
            <div class="memory">
                <button class="memory-btn" onclick="memAdd()">M+</button>
                <button class="memory-btn" onclick="memSubtract()">M−</button>
                <button class="memory-btn" onclick="memRecall()">MR</button>
                <button class="memory-btn" onclick="memClear()">MC</button>
            </div>
            <div class="expression" id="expression"></div>
            <div class="display" id="display">0</div>
            <div class="buttons">
                <!-- Row 1 -->
                <button class="clear" onclick="clearDisplay()">C</button>
                <button class="delete" onclick="deleteLastChar()">DEL</button>
                <button class="operator" onclick="appendOperator('/')" title="Divide">÷</button>
                <button class="operator" onclick="appendOperator('*')" title="Multiply">×</button>

                <!-- Row 2 -->
                <button class="number" onclick="appendNumber('7')">7</button>
                <button class="number" onclick="appendNumber('8')">8</button>
                <button class="number" onclick="appendNumber('9')">9</button>
                <button class="operator" onclick="appendOperator('-')" title="Subtract">−</button>

                <!-- Row 3 -->
                <button class="number" onclick="appendNumber('4')">4</button>
                <button class="number" onclick="appendNumber('5')">5</button>
                <button class="number" onclick="appendNumber('6')">6</button>
                <button class="operator" onclick="appendOperator('+')" title="Add">+</button>

                <!-- Row 4 -->
                <button class="number" onclick="appendNumber('1')">1</button>
                <button class="number" onclick="appendNumber('2')">2</button>
                <button class="number" onclick="appendNumber('3')">3</button>
                <button class="advanced teal" onclick="appendOperator('^')">x^y</button>

                <!-- Row 5 -->
                <button class="number" onclick="appendNumber('0')">0</button>
                <button class="number" onclick="appendNumber('.')">.</button>
                <button class="operator" onclick="appendOperator('%')">%</button>
                <button class="advanced teal" onclick="squareRoot()">√</button>

                <!-- Row 6 -->
                <button class="advanced" onclick="toggleParenthesis()">( )</button>
                <button class="advanced" onclick="toggleSign()">+/−</button>
                <button class="advanced" onclick="reciprocal()">1/x</button>
                <button class="advanced" onclick="square()">x²</button>

                <!-- Row 7 -->
                <button class="advanced" onclick="logarithm()">log</button>
                <button class="advanced" onclick="naturalLog()">ln</button>
                <button class="advanced" onclick="sine()">sin</button>
                <button class="advanced" onclick="cosine()">cos</button>

                <!-- Row 8 -->
                <button class="advanced" onclick="tangent()">tan</button>
                <button class="advanced" onclick="factorial()">x!</button>
                <button class="advanced" onclick="euler()">e</button>
                <button class="advanced" onclick="pi()">π</button>

                <!-- Row 9 -->
                <button class="equals" onclick="calculate()">=</button>
            </div>
        </div>

        <div class="history">
            <h2>History</h2>
            <div class="history-items" id="historyItems">
                <div style="color: #999; text-align: center; padding: 20px; font-size: 0.9em;">No calculations yet</div>
            </div>
        </div>
    </div>

    <script>
        let display = document.getElementById('display');
        let expression = document.getElementById('expression');
        let historyItems = document.getElementById('historyItems');
        let memoryDisplay = document.getElementById('memoryDisplay');

        let currentInput = '0';
        let firstNumber = null;
        let operation = null;
        let shouldResetDisplay = false;
        let fullExpression = '';
        let memory = 0;
        let calculationHistory = [];
        let parenthesisDepth = 0;

        function updateDisplay() {
            display.textContent = currentInput;
        }

        function updateExpression() {
            expression.textContent = fullExpression;
        }

        function updateMemoryDisplay() {
            memoryDisplay.textContent = memory !== 0 ? `Memory: ${memory}` : '';
        }

        function appendNumber(num) {
            if (shouldResetDisplay) {
                currentInput = num;
                shouldResetDisplay = false;
            } else {
                if (currentInput === '0' && num !== '.') {
                    currentInput = num;
                } else if (num === '.' && currentInput.includes('.')) {
                    return;
                } else {
                    currentInput += num;
                }
            }
            fullExpression = fullExpression.split(' ')[0] + (fullExpression.includes(' ') ? ' ' + fullExpression.split(' ')[1] + ' ' : '') + currentInput;
            updateDisplay();
            updateExpression();
        }

        function appendOperator(op) {
            if (firstNumber === null) {
                firstNumber = parseFloat(currentInput);
                fullExpression = currentInput + ' ' + getSymbol(op) + ' ';
                expression.textContent = fullExpression;
            } else if (!shouldResetDisplay) {
                // Auto-calculate when chaining operators
                calculate();
                fullExpression = currentInput + ' ' + getSymbol(op) + ' ';
                expression.textContent = fullExpression;
            } else {
                // Just update the operator if already selected
                fullExpression = firstNumber + ' ' + getSymbol(op) + ' ';
                expression.textContent = fullExpression;
            }
            operation = op;
            shouldResetDisplay = true;
        }

        function getSymbol(op) {
            const symbols = { '+': '+', '-': '−', '*': '×', '/': '÷', '^': '^', '%': '%' };
            return symbols[op] || op;
        }

        function calculate() {
            if (firstNumber === null || operation === null) return;

            let secondNumber = parseFloat(currentInput);
            let result = 0;
            let isError = false;

            switch (operation) {
                case '+':
                    result = firstNumber + secondNumber;
                    break;
                case '-':
                    result = firstNumber - secondNumber;
                    break;
                case '*':
                    result = firstNumber * secondNumber;
                    break;
                case '/':
                    if (secondNumber === 0) {
                        currentInput = 'Error: Div by 0';
                        display.style.color = '#ef4444';
                        isError = true;
                        break;
                    }
                    result = firstNumber / secondNumber;
                    break;
                case '^':
                    result = Math.pow(firstNumber, secondNumber);
                    break;
                case '%':
                    result = (firstNumber / 100) * secondNumber;
                    break;
            }

            if (!isError) {
                display.style.color = '#3b82f6';
                currentInput = parseFloat(result.toFixed(10)).toString();
                addToHistory(`${fullExpression} = ${result}`);
                fullExpression = result.toString();
            }
            firstNumber = null;
            operation = null;
            shouldResetDisplay = true;
            updateDisplay();
            updateExpression();
        }

        function squareRoot() {
            let num = parseFloat(currentInput);
            if (num < 0) {
                currentInput = 'Error';
                display.style.color = '#ef4444';
            } else {
                currentInput = parseFloat(Math.sqrt(num).toFixed(10)).toString();
                display.style.color = '#3b82f6';
                addToHistory(`√${num} = ${currentInput}`);
                fullExpression = currentInput;
            }
            shouldResetDisplay = true;
            updateDisplay();
            updateExpression();
        }

        function square() {
            let num = parseFloat(currentInput);
            currentInput = parseFloat(Math.pow(num, 2).toFixed(10)).toString();
            display.style.color = '#3b82f6';
            addToHistory(`${num}² = ${currentInput}`);
            fullExpression = currentInput;
            shouldResetDisplay = true;
            updateDisplay();
            updateExpression();
        }

        function reciprocal() {
            let num = parseFloat(currentInput);
            if (num === 0) {
                currentInput = 'Error';
                display.style.color = '#ef4444';
            } else {
                currentInput = parseFloat((1 / num).toFixed(10)).toString();
                display.style.color = '#3b82f6';
                addToHistory(`1/${num} = ${currentInput}`);
                fullExpression = currentInput;
            }
            shouldResetDisplay = true;
            updateDisplay();
            updateExpression();
        }

        function logarithm() {
            let num = parseFloat(currentInput);
            if (num <= 0) {
                currentInput = 'Error';
                display.style.color = '#ef4444';
            } else {
                currentInput = parseFloat(Math.log10(num).toFixed(10)).toString();
                display.style.color = '#3b82f6';
                addToHistory(`log(${num}) = ${currentInput}`);
                fullExpression = currentInput;
            }
            shouldResetDisplay = true;
            updateDisplay();
            updateExpression();
        }

        function naturalLog() {
            let num = parseFloat(currentInput);
            if (num <= 0) {
                currentInput = 'Error';
                display.style.color = '#ef4444';
            } else {
                currentInput = parseFloat(Math.log(num).toFixed(10)).toString();
                display.style.color = '#3b82f6';
                addToHistory(`ln(${num}) = ${currentInput}`);
                fullExpression = currentInput;
            }
            shouldResetDisplay = true;
            updateDisplay();
            updateExpression();
        }

        function sine() {
            let num = parseFloat(currentInput);
            // Convert to degrees for more intuitive results
            let radians = num * (Math.PI / 180);
            currentInput = parseFloat(Math.sin(radians).toFixed(10)).toString();
            display.style.color = '#3b82f6';
            addToHistory(`sin(${num}°) = ${currentInput}`);
            fullExpression = currentInput;
            shouldResetDisplay = true;
            updateDisplay();
            updateExpression();
        }

        function cosine() {
            let num = parseFloat(currentInput);
            let radians = num * (Math.PI / 180);
            currentInput = parseFloat(Math.cos(radians).toFixed(10)).toString();
            display.style.color = '#3b82f6';
            addToHistory(`cos(${num}°) = ${currentInput}`);
            fullExpression = currentInput;
            shouldResetDisplay = true;
            updateDisplay();
            updateExpression();
        }

        function tangent() {
            let num = parseFloat(currentInput);
            let radians = num * (Math.PI / 180);
            currentInput = parseFloat(Math.tan(radians).toFixed(10)).toString();
            display.style.color = '#3b82f6';
            addToHistory(`tan(${num}°) = ${currentInput}`);
            fullExpression = currentInput;
            shouldResetDisplay = true;
            updateDisplay();
            updateExpression();
        }

        function factorial() {
            let num = parseInt(currentInput);
            if (num < 0) {
                currentInput = 'Error';
                display.style.color = '#ef4444';
                return;
            }
            if (num > 170) {
                currentInput = 'Too Large';
                display.style.color = '#ef4444';
                return;
            }
            let result = 1;
            for (let i = 2; i <= num; i++) {
                result *= i;
            }
            currentInput = result.toString();
            display.style.color = '#3b82f6';
            addToHistory(`${num}! = ${result}`);
            fullExpression = currentInput;
            shouldResetDisplay = true;
            updateDisplay();
            updateExpression();
        }

        function euler() {
            currentInput = Math.E.toFixed(10);
            display.style.color = '#3b82f6';
            fullExpression = 'e';
            updateDisplay();
            updateExpression();
            shouldResetDisplay = true;
        }

        function pi() {
            currentInput = Math.PI.toFixed(10);
            display.style.color = '#3b82f6';
            fullExpression = 'π';
            updateDisplay();
            updateExpression();
            shouldResetDisplay = true;
        }

        function toggleSign() {
            let num = parseFloat(currentInput);
            currentInput = (-num).toString();
            updateDisplay();
        }

        function toggleParenthesis() {
            if (parenthesisDepth === 0) {
                currentInput = currentInput === '0' ? '' : currentInput;
                fullExpression += '(';
                parenthesisDepth++;
            } else {
                fullExpression += ')';
                parenthesisDepth--;
            }
            updateExpression();
        }

        function deleteLastChar() {
            if (currentInput.length > 1) {
                currentInput = currentInput.slice(0, -1);
            } else {
                currentInput = '0';
            }
            fullExpression = fullExpression.slice(0, -1);
            updateDisplay();
            updateExpression();
        }

        function clearDisplay() {
            currentInput = '0';
            firstNumber = null;
            operation = null;
            shouldResetDisplay = false;
            fullExpression = '';
            parenthesisDepth = 0;
            display.style.color = '#3b82f6';
            updateDisplay();
            updateExpression();
        }

        function addToHistory(calc) {
            calculationHistory.unshift(calc);
            if (calculationHistory.length > 20) calculationHistory.pop();
            updateHistoryDisplay();
        }

        function updateHistoryDisplay() {
            if (calculationHistory.length === 0) {
                historyItems.innerHTML = '<div style="color: #64748b; text-align: center; padding: 20px; font-size: 0.9em;">No calculations yet</div>';
                return;
            }
            historyItems.innerHTML = calculationHistory.map((item, index) => 
                `<div class="history-item" onclick="useHistoryItem('${item.split(' = ')[1]}')">${item}</div>`
            ).join('');
        }

        function useHistoryItem(value) {
            currentInput = value;
            shouldResetDisplay = true;
            display.style.color = '#3b82f6';
            updateDisplay();
        }

        function memAdd() {
            memory += parseFloat(currentInput);
            updateMemoryDisplay();
            shouldResetDisplay = true;
        }

        function memSubtract() {
            memory -= parseFloat(currentInput);
            updateMemoryDisplay();
            shouldResetDisplay = true;
        }

        function memRecall() {
            currentInput = memory.toString();
            updateDisplay();
            shouldResetDisplay = true;
        }

        function memClear() {
            memory = 0;
            updateMemoryDisplay();
        }

        // Keyboard support
        document.addEventListener('keydown', (e) => {
            if (e.key >= '0' && e.key <= '9') appendNumber(e.key);
            if (e.key === '.') appendNumber('.');
            if (e.key === '+') appendOperator('+');
            if (e.key === '-') appendOperator('-');
            if (e.key === '*') appendOperator('*');
            if (e.key === '/') { e.preventDefault(); appendOperator('/'); }
            if (e.key === 'Enter' || e.key === '=') { e.preventDefault(); calculate(); }
            if (e.key === 'Backspace') deleteLastChar();
            if (e.key === 'Escape') clearDisplay();
        });

        updateDisplay();
        updateMemoryDisplay();
    </script>
</body>
</html>
